<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª â€” Ø§Ù„Ø¯Ù„Ø§Ù„Ø©</title>
<style>
body{font-family:Arial;background:#f6faff;margin:0;padding:20px;text-align:right}
.container{max-width:700px;margin:auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.1)}
input,textarea,button{width:100%;padding:10px;margin:6px 0;border-radius:6px;border:1px solid #ddd;font-size:15px;box-sizing:border-box}
button{background:#0078d7;color:#fff;cursor:pointer}
button:hover{background:#005fa3}
.status{margin-top:10px;color:#0078d7}
.ads{margin-top:20px}
.ad{border:1px solid #ddd;border-radius:8px;padding:10px;margin-top:10px}
.ad img{max-width:100%;border-radius:6px}
.lock{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;text-align:center}
</style>
</head>
<body>

<div class="lock" id="lock">
  <h2>ğŸ” Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
  <input id="pass" type="password" placeholder="ahmedosman">
  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  <p id="err" style="color:red"></p>
</div>

<div class="container" id="panel" style="display:none">
<h2>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© â€” Ø§Ù„Ø¯Ù„Ø§Ù„Ø©</h2>
<p>Ø£Ù„ØµÙ‚ Ù…ÙØªØ§Ø­ JSONBin Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª.</p>

<label>ğŸ”‘ X-Master-Key</label>
<input id="key" placeholder="$2a$10$7cesS0lV1PuOAdhJjhxTqeAzTbimMwKcQqbHAixEgOWl/d5zeSucO">

<button id="loadBtn">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</button>
<hr>

<h3>â• Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¹Ù„Ø§Ù†</h3>
<input id="cat" placeholder="Ø§Ù„ÙØ¦Ø© (Ø¹Ù‚Ø§Ø±Ø§ØªØŒ Ø³ÙŠØ§Ø±Ø§ØªØŒ Ø®Ø¯Ù…Ø§Øª...)">
<input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†">
<textarea id="desc" placeholder="Ø§Ù„ÙˆØµÙ"></textarea>
<input id="loc" placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹">
<input id="contact" placeholder="ÙˆØ³ÙŠÙ„Ø© Ø§Ù„ØªÙˆØ§ØµÙ„">
<input id="img" type="file" accept="image/*">
<button id="saveBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>

<hr>
<h3>ğŸ—‘ï¸ Ø­Ø°Ù Ø¥Ø¹Ù„Ø§Ù† Ø¨Ø§Ù„ÙƒÙˆØ¯</h3>
<input id="delcode" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†">
<button id="deleteBtn">Ø­Ø°Ù</button>

<div class="status" id="status"></div>
<div class="ads" id="ads"></div>
</div>

<script>
// ---------------------
// SIMPLE PASSWORD CHECK
// ---------------------
const PASSWORD_HASH = "4d9d1a2dc6a244d1e9bce863f8c7619e"; // Hashed password placeholder

async function login(){
  const input = document.getElementById('pass').value;
  const hash = await digest(input);
  if(hash === PASSWORD_HASH){
    document.getElementById('lock').style.display="none";
    document.getElementById('panel').style.display="block";
  } else {
    document.getElementById('err').textContent = "âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
  }
}

async function digest(str){
  const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

// ---------------------
// AD MANAGEMENT SECTION
// ---------------------
const BIN_ID = "69144054ae596e708f5418a2";
const BIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
let apiKey = "";
let ads = [];

document.getElementById('loadBtn').onclick = load;
document.getElementById('saveBtn').onclick = saveAd;
document.getElementById('deleteBtn').onclick = deleteAd;

async function load(){
  apiKey = document.getElementById('key').value.trim();
  if(!apiKey) return alert("Ø£Ù„ØµÙ‚ Ø§Ù„Ù…ÙØªØ§Ø­ Ø£ÙˆÙ„Ø§Ù‹!");
  try{
    const res = await fetch(`${BIN_URL}/latest`, {headers:{'X-Master-Key':apiKey}});
    const json = await res.json();
    ads = json.record.ads || [];
    render();
    status("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ("+ads.length+")");
  }catch(e){status("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„");}
}

async function saveAd(){
  const cat = v('cat'), name = v('name'), desc = v('desc'), loc = v('loc'), contact = v('contact');
  if(!cat||!name||!desc||!loc||!contact) return alert("Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
  
  let img64 = "";
  const file = document.getElementById('img').files[0];
  if(file){
    img64 = await toBase64(file);
  }

  const code = Date.now().toString().slice(-6);
  ads.push({cat,name,desc,loc,contact,img:img64,code});
  await save();
  render();
  ['cat','name','desc','loc','contact','img'].forEach(id=>document.getElementById(id).value="");
}

async function deleteAd(){
  const code = v('delcode');
  if(!code) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯");
  ads = ads.filter(a=>a.code!==code);
  await save();
  render();
  document.getElementById('delcode').value="";
}

async function save(){
  try{
    await fetch(BIN_URL,{
      method:'PUT',
      headers:{
        'Content-Type':'application/json',
        'X-Master-Key':apiKey
      },
      body:JSON.stringify({ads})
    });
    status("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
  }catch(e){status("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸");}
}

function render(){
  const c = document.getElementById('ads');
  c.innerHTML = ads.map(a=>`
  <div class="ad">
    <b>${a.name}</b> (${a.cat})<br>${a.desc}<br>ğŸ“ ${a.loc} â€” â˜ï¸ ${a.contact}<br>
    ${a.img ? `<img src="${a.img}">` : ""}
    <div>Ø§Ù„ÙƒÙˆØ¯: ${a.code}</div>
  </div>`).join('');
}

function v(id){return document.getElementById(id).value.trim();}
function status(t){document.getElementById('status').textContent=t;}
function toBase64(file){return new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>res(r.result);r.onerror=rej;r.readAsDataURL(file);});}
</script>
</body>
</html>
